<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NYT Best Sellers Overview</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #tableOfContents {
        margin-right: 10px;
      }
      .card-body {
        margin: auto !important;
      }
      .row {
        border: 3px solid black;
        padding-right: 20px;
      }
      .btn {
        margin-left: 35% !important;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .listName:not(:first-of-type) {
        margin-top: 200px; /* Adjust the margin value as needed */
      }
    </style>
  </head>
  <body>
    <h1>New York Times Best Sellers Overview</h1>
    <div>
      <select id="tableOfContents" onchange="navigateToSection()"></select>
    </div>
    <div id="bestSellerList"></div>

    <script>
      console.log("Fetching New York Times Best Sellers Overview");
      const apiKey = "6ITS7aI5pCKdIjzyr2zQAW15pD9Y9Bns";
      const url = `https://api.nytimes.com/svc/books/v3/lists/overview.json?api-key=${apiKey}`;

      fetch(url, { method: "GET" })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          const lists = data.results.lists;
          let container = document.getElementById("bestSellerList");
          container.innerHTML = "";
          let tableOfContents = document.getElementById("tableOfContents");
          tableOfContents.innerHTML = "";
          for (const list of lists) {
            let listNameEncoded = list.list_name_encoded;
            let listHtml = `<h2 id="${listNameEncoded}" class="listName" style="font-size: 50px;font-weight:bold;">${list.display_name}</h2>`;
            tableOfContents.innerHTML += `<option value="${listNameEncoded}">${list.display_name}</option>`;

            for (const book of list.books) {
              listHtml += `
              <div class="row">
                <div class="col-xl-1 col-sm-2">
                  <img
                    src="${book.book_image}"
                    class="card-img-top"
                    alt="${book.title}"
                  />
                </div>
                <div class="col-xl-8 col-sm-7 card-body">
                    <h5 class="card-title">${book.title} by ${book.author}</h5>
                    <p class="card-text">${book.description}</p>
                </div>
                <div class="col-3 card-body">
                    <a href="${book.amazon_product_url}" target="_blank" class="btn btn-primary">Buy on Amazon</a>
                </div>
              </div>
                        `;
            }
            container.innerHTML += listHtml;
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          document.getElementById("bestSellerList").innerHTML =
            "Failed to load data.";
        });
      function navigateToSection() {
        const sectionId = document.getElementById("tableOfContents").value;
        if (sectionId) {
          const section = document.getElementById(sectionId);
          section.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
    </script>
  </body>
</html>
